<head>
<title>ﾒｯｾｰｼﾞ詳細</title>
</head>


<body>
  <%= link_to  "戻る", messages_path, class: 'btn btn-info btn-sm' %>

  <!--- ﾍﾟｰｼﾞ前後送り --->
<div class="float-left">
  <% if @message.previous.present? %>
    <%= link_to message_path(@message.previous) do %>
      <% if @message.previous.title.present? %>
        << <%= @message.previous.title %>
      <% else %>
        <%= '<< 前へ' %>
      <%end%>      
    <%end%>
  <%end%>
</div>
<div class="float-right">
  <% if @message.next.present? %>
    <%= link_to message_path(@message.next) do %>
      <% if @message.next.title.present? %>
        <%= @message.next.title %> >>
      <% else %>
        <%= '次へ >>' %>
      <%end%>
    <%end%>
  <%end%>
</div>


  <!--- ﾒｯｾｰｼﾞ --->
<div class='message'>  
  <% if @message.title == "" %>
    <%= 'ﾀｲﾄﾙなし' %>
  <%else%>
    <%= @message.title %>
  <%end%>
  <span>展開者: </span><%= @user.name %>
  <p><span><%='展開日:' %></span><%= @message.created_at.strftime("%Y/%m/%d %H:%M") %></p>
  <%= simple_format(@message.body)%>  <!--- 改行とか反映される --->
  <% if @message.images.attached? %>
    <% @message.images.each do |image| %>
      <% if image.filename.to_s =~ /\.jpeg$|\.jpg$|\.gif$|\.png$|\.bmp$/ %>
        <%=link_to image_tag(image , height: '20'), (rails_blob_path(image, disposition: "attachment"))%>
      <% elsif image.filename.to_s  =~ /\.mp4$|\.wmv$|\.avi$|\.mov$/  %>
        <%=link_to image_tag(image.preview(resize: "100x100>")), (rails_blob_path(image, disposition: "attachment")) %>
      <%else%>
        <%=link_to image_tag("file_icon.png", height: '20'), (rails_blob_path(image, disposition: "attachment")) %>
      <%end%>
      <%= image.filename %>
    <% end %>
  <% end %>
<div>

<br>

  <!--- ｺﾒﾝﾄﾌｫｰﾑ(ajax) --->
<div class='comment_form'>
  <p>コメント:<%= current_user.name %></p>
  <%= form_for @comment, url:  message_comments_path(@message) , method: :post, html: { multipart: true}, remote: true do |f| %>
    <%= f.text_area :content, :size=>"80x6", :maxlength => "5000" %>
    <%= f.file_field :images, multiple: true,id: "file",class: 'image',:size=>"60"%>
    <%= f.hidden_field :message_id, :value => @message.id %>
    <%= f.hidden_field :user_id, :value => current_user.id %>
    <%= f.hidden_field :user_name, :value => current_user.name %>
    <%= f.submit 'コメント' %>
  <%end%>
</div>

  <!--- ｺﾒﾝﾄ一覧(ajax) --->
  <table class ="table", id = "comments">
    <%= render @comments %>
  </table>

</body>